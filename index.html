<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CRT Hack Lyrics</title>
<style>
body {
  margin:0; padding:0; overflow:hidden;
  background:#000; /* fond noir permanent */
  font-family: "Courier New", monospace;
  color:#0f0;
}

/* Hitbox plein écran pour cliquer */
#overlay {
  position:fixed; inset:0;
  background:#fff; /* écran initial blanc */
  display:flex; justify-content:center; align-items:center;
  cursor:pointer; z-index:9999;
  transition: background 0.8s ease;
  transform-origin:center;
}

#overlayText {
  font-size:1.2rem;
  color:#000;
}

/* Texte style terminal / hacking */
#lyrics {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%) rotateX(5deg) rotateY(5deg);
  font-size:2rem; line-height:1.5; white-space:pre-wrap;
  letter-spacing:2px;
  text-shadow:0 0 1px #0f0,0 0 2px #0f0;
  filter: contrast(1.5) brightness(1.1);
}

/* Scanlines overlay pour effet CRT */
#screenEffect {
  position:fixed; inset:0;
  pointer-events:none;
  background: repeating-linear-gradient(
    to bottom,
    rgba(0,255,0,0.05),
    rgba(0,255,0,0.05) 1px,
    transparent 1px,
    transparent 3px
  );
  mix-blend-mode: screen;
  z-index:998;
}
</style>
</head>
<body>

<div id="overlay">
  <div id="overlayText">Cliquez pour activer la musique</div>
</div>

<div id="lyrics"></div>
<div id="screenEffect"></div>

<audio id="song" preload="auto">
  <source src="musique.mp3" type="audio/mpeg">
</audio>

<script>
const overlay = document.getElementById('overlay');
const overlayText = document.getElementById('overlayText');
const audio = document.getElementById('song');
const lyricsDiv = document.getElementById('lyrics');
const screenEffect = document.getElementById('screenEffect');

const text = "Are you trying to tell me you are not completely blown away by my magnificent entrance just now?".split(" ");

const musicStart = 75; // 1:15
const lyricStart = 82.5; // 1:22.5
const lyricEnd = 87;     // 1:27
const lyricDuration = lyricEnd - lyricStart;

let overlayGone = false;

// Glitch / tremblement CRT
function crtGlitch() {
  if (overlayGone) return;
  const x = (Math.random()-0.5)*4;
  const y = (Math.random()-0.5)*4;
  const z = (Math.random()-0.5)*0.5;
  lyricsDiv.style.transform = `translate(-50%,-50%) rotateX(${x}deg) rotateY(${y}deg) skew(${z}deg, ${z}deg)`;
  requestAnimationFrame(crtGlitch);
}

// Petit flicker / bruit sur scanlines
function scanlineFlicker() {
  if (overlayGone) return;
  screenEffect.style.opacity = 0.03 + Math.random()*0.07;
  requestAnimationFrame(scanlineFlicker);
}

overlay.addEventListener('click', async () => {
  overlayGone = false;
  crtGlitch();
  scanlineFlicker();

  // fade vers noir rapide
  overlay.style.background = "#000";
  overlayText.style.color = "#0f0";

  // Lecture audio
  audio.currentTime = musicStart;
  audio.muted = false;
  await audio.play();

  // Transition angles plus lente
  const startTime = performance.now();
  const duration = 1500; // 1.5s pour aplatir
  function flattenAngles(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed/duration,1);
    const angle = (1-progress)*5;
    lyricsDiv.style.transform = `translate(-50%,-50%) rotateX(${angle}deg) rotateY(${angle}deg)`;
    if(progress < 1) requestAnimationFrame(flattenAngles);
  }
  flattenAngles(performance.now());

  // Supprime overlay après fade
  setTimeout(()=>{overlay.remove(); overlayGone=true;}, 800);

  // Lyrics mot par mot
  audio.addEventListener("timeupdate", () => {
    const t = audio.currentTime;
    if (t >= lyricStart && t <= lyricEnd) {
      const elapsed = t - lyricStart;
      const wordIndex = Math.floor((elapsed / lyricDuration) * text.length);
      lyricsDiv.innerHTML = text.slice(0, wordIndex+1).join(" ");
    } else if (t < lyricStart) {
      lyricsDiv.innerHTML = "";
    } else if (t > lyricEnd) {
      lyricsDiv.innerHTML = text.join(" ");
    }
  });
});
</script>

</body>
</html>
