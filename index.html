<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Musique â€” Hitbox invisible</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0; font-family: system-ui, sans-serif;
      min-height: 100vh; display: grid; place-items: center;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
    }
    h1 { margin: 0 0 0.5rem }
    p { opacity: 0.85; margin: 0 0 1.5rem }

    /* Overlay = hitbox gÃ©ante et invisible */
    .sound-overlay {
      position: fixed; inset: 0;
      background: transparent;   /* invisible */
      display: grid; place-items: center;
      cursor: pointer;           /* indique qu'on peut cliquer */
      z-index: 9999;
    }

    /* Bouton visible (facultatif) â€” le clic marche aussi en dehors */
    .btn {
      padding: 12px 22px; border: 0; border-radius: 999px;
      background: #ffcc00; color: #222; font-weight: 700;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
    }
    .btn:focus-visible { outline: 3px solid #fff; outline-offset: 3px; }
    .hint { font-size: .9rem; opacity: .9; margin-top: .75rem }
  </style>
</head>
<body>
  <main>
    <h1>Bienvenue ðŸŽ¶</h1>
    <p>Musique de fond (dÃ©marre Ã  1:15 aprÃ¨s votre clic)</p>
  </main>

  <!-- Audio prÃ©chargÃ©, muet par dÃ©faut -->
  <audio id="bgMusic" preload="auto" loop muted>
    <source src="musique.mp3" type="audio/mpeg">
  </audio>

  <!-- Overlay = hitbox plein Ã©cran, mais on affiche un bouton au centre -->
  <div id="soundOverlay" class="sound-overlay"
       role="button"
       aria-label="Activer le son (cliquer n'importe oÃ¹)">
    <div style="text-align:center;">
      <button class="btn" type="button">ðŸ”Š Activer le son</button>
      <div class="hint">(vous pouvez aussi cliquer nâ€™importe oÃ¹)</div>
    </div>
  </div>

  <script>
    const overlay = document.getElementById('soundOverlay');
    const audio   = document.getElementById('bgMusic');

    async function enableSound() {
      try {
        // Place le curseur Ã  1:15 (75s) au premier geste utilisateur
        // On attend metadata si nÃ©cessaire
        if (isNaN(audio.duration) || audio.duration === Infinity) {
          await new Promise(resolve => {
            const onMeta = () => { audio.removeEventListener('loadedmetadata', onMeta); resolve(); };
            audio.addEventListener('loadedmetadata', onMeta, { once: true });
          });
        }
        audio.currentTime = Math.min(75, (audio.duration || 1) - 0.1); // sÃ©curitÃ© si durÃ©e < 75s
        audio.muted = false;
        await audio.play();
      } catch(e) {
        // Si le play Ã©choue, on reste muet et on rÃ©essaie au prochain clic
        console.warn('Lecture bloquÃ©e :', e);
        return;
      }
      // Retire la hitbox gÃ©ante aprÃ¨s succÃ¨s
      overlay.remove();
    }

    // Un clic n'importe oÃ¹ sur l'overlay dÃ©clenche l'activation
    overlay.addEventListener('click', enableSound);
    // AccessibilitÃ© clavier
    overlay.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); enableSound(); }
    });
  </script>
</body>
</html>
